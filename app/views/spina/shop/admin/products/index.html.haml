%header#header
  .breadcrumbs
    = render_breadcrumbs separator: '<div class="divider"></div>'

    = link_to spina.new_by_category_shop_admin_products_path, class: 'button button-mini icon-only', data: {remote: true} do
      %i.icon.icon-plus{style: 'vertical-align: bottom'}
  %nav#secondary
    %ul
      %li{class: ("active" if action_name == "index")}
        = link_to spina.shop_admin_products_path do
          =t 'spina.shop.products.title'

      %li{class: ("active" if action_name == "archived")}
        = link_to spina.archived_shop_admin_products_path do
          =t 'spina.shop.products.archived_title'

      %li
        = link_to spina.shop_admin_product_bundles_path do
          = Spina::Shop::ProductBundle.model_name.human count: 2

      %li
        = link_to spina.shop_admin_stock_forecast_path do
          Voorraad

= search_form_for @q, url: (action_name == "index" ? spina.shop_admin_products_path : spina.archived_shop_admin_products_path), html: {class: 'filter-form'} do |f|
  .filter-form-simple
    .filter-form-input
      = f.text_field :sku_or_location_or_translations_name_cont, style: 'box-sizing: border-box', placeholder: 'Zoek op naam, SKU of locatie'
      = link_to "filters #{@q.conditions.any? ? '(' + @q.conditions.count.to_s + ')' : ''} instellen", '#', class: 'filter-form-advanced-link'

    = button_tag type: :submit, class: 'button button-primary icon-only' do
      = icon('search')

  .filter-form-advanced
    .filter-form-advanced-group
      .filter-form-label= Spina::Shop::ProductCategory.model_name.human(count: 2)
      .filter-form-control
        - options = Spina::Shop::ProductCategory.pluck(:name, :id)
        = f.select :product_category_id_in, options, {}, class: 'select2', style: 'width: 100%', multiple: true

    .filter-form-advanced-group
      .filter-form-label= Spina::Shop::ProductCollection.model_name.human(count: 2)
      .filter-form-control
        - options = Spina::Shop::ProductCollection.pluck(:name, :id)
        = f.select :product_collections_id_in, options, {}, class: 'select2', style: 'width: 100%', multiple: true

    .filter-form-advanced-group
      .filter-form-label= Spina::Shop::Store.model_name.human(count: 2)
      .filter-form-control
        - options = Spina::Shop::Store.pluck(:name, :id)
        = f.select :stores_id_in, options, {}, class: 'select2', style: 'width: 100%', multiple: true

.table-container.infinite-table
  %table.table.table-clickable
    %thead
      %tr
        %th
        %th
        %th= sort_link [:spina, @q], :translations_name, Spina::Shop::Product.human_attribute_name(:name), {}, class: 'table-sort'
        - if stores.any?
          %th= Spina::Shop::Store.model_name.human(count: 2)
        %th{style: 'text-align: right'}= sort_link [:spina, @q], :base_price, Spina::Shop::Product.human_attribute_name(:base_price), {}, class: 'table-sort'
        %th{style: 'text-align: right'}= sort_link [:spina, @q], :location, Spina::Shop::Product.human_attribute_name(:location), {}, class: 'table-sort'
        %th{style: 'text-align: right'}= sort_link [:spina, @q], :stock_level, ['stock_enabled desc', :stock_level], Spina::Shop::Product.human_attribute_name(:stock_level), {}, class: 'table-sort'
        - if Spina::Shop::Product.where(can_expire: true).any?
          %th.align-right= sort_link [:spina, @q], :expiration_date, Spina::Shop::Product.human_attribute_name(:expiration_date), {}, class: 'table-sort'
        %th

    %tbody
      = render partial: "single_product", collection: @products

  .pagination= link_to_next_page @products, 'Next'
